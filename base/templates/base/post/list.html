{% extends "base/base.html" %}
{% load blog_tags %}

{% block title %}My blog{% endblock title %}

{% block content %}
    {% if tag %}
        <div class="alert alert-info d-flex align-items-center mb-4">
            <i class="bi bi-tag-fill me-2"></i>
            <div>
                <h2 class="mb-0 h5">Articles tagged with {{ tag.name }}</h2>
                <a href="{% url 'base:post_list' %}" class="btn btn-sm btn-outline-secondary mt-2">
                    <i class="bi bi-x-circle me-1"></i>Clear Filter
                </a>
            </div>
        </div>
    {% endif %}

    <div class="row">
        {% for post in posts %}
            <div class="col-12 mb-4">
                <div class="card sidebar-card border-0">
                    <div class="card-body">
                        <!-- Title -->
                        <h2 class="card-title mb-3">
                            <a href="{{ post.get_absolute_url }}"
                               class="text-decoration-none text-dark">
                                {{ post.title }}
                            </a>
                        </h2>
                        
                        <!-- Tags -->
                        <div class="mb-3">
                            <span class="fw-semibold text-muted me-2">Tags:</span>
                            {% for tag in post.tags.all %}
                                <a href="{% url 'base:post_list_by_tag' tag.slug %}"
                                   class="badge bg-primary text-decoration-none me-1">
                                    {{ tag.name }}
                                </a>{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </div>
                        
                        <!-- Date and Meta info -->
                        <p class="text-muted small mb-3">
                            <i class="bi bi-calendar3 me-1"></i>Published {{ post.publish }} by {{ post.author }}
                            | <i class="bi bi-file-text me-1"></i>{{ post.get_word_count }} words
                            {% with post.get_reading_time as reading_time %}
                                | <i class="bi bi-clock me-1"></i>{{ reading_time }} minute{{ reading_time|pluralize }}
                            {% endwith %}
                        </p>
                        
                        <!-- Content preview -->
                        <div class="post-preview">
                            {{ post.body|markdown|truncatewords_html:30 }}
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% include "pagination.html" with page=posts %}

    <style>
        .post-preview p {
            margin-bottom: 1rem;
            line-height: 1.6;
            color: #6c757d;
        }
        .post-preview h1, .post-preview h2, .post-preview h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #495057;
        }
        .sidebar-card {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
        }
    </style>
{% endblock content %}